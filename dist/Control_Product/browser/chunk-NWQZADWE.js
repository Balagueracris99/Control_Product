import{a as ae,b as me}from"./chunk-SKKXDCFB.js";import{a as St,b as Pt}from"./chunk-4AYKK4XH.js";import{a as te,c as nt,d as at,g as Gt}from"./chunk-5LQPTCW5.js";import{a as Et,b as kt,c as wt,d as Ot,e as It,f as Tt,g as Dt,h as Nt,i as Ft,j as Lt,k as Rt,l as $t,m as At,n as Ut,o as jt,p as Ht,q as zt,r as Vt,s as Bt,t as le,u as ce,v as de}from"./chunk-PESQD6XR.js";import"./chunk-Y26WRQJA.js";import{a as R,b as $}from"./chunk-W5UQ6ECB.js";import"./chunk-DQFV7RUH.js";import"./chunk-SB62MEXX.js";import{a as vt,b as oe,c as ne,g as yt,h as bt,k as Mt,l as xt}from"./chunk-45557K5V.js";import{$ as E,$a as f,$b as S,$c as ut,A as et,Ab as J,D as Xt,Ia as D,Ja as it,L as O,Ma as h,Nb as F,R as I,Rc as mt,S as rt,Ta as ot,Tc as b,Ua as u,V as T,Va as p,Vc as lt,W as s,Wa as Yt,Wc as ct,Xa as Zt,Ya as _,Yc as dt,Za as o,Zc as ee,_ as P,_a as i,_c as st,a as Wt,ad as re,b as Kt,bd as pt,cc as L,cd as ft,db as v,eb as y,ed as A,fd as U,g as Jt,gb as N,gd as gt,hd as _t,ib as x,id as ie,jd as Ct,kb as C,kd as j,m as tt,md as ht,nd as H,od as z,q as K,w as Qt,wa as m,yb as n,zb as g}from"./chunk-3DDZNKYA.js";var V=class e{constructor(t){this.http=t}baseUrl=`${A.apiUrl}/categories`;getAll(){return this.http.get(this.baseUrl)}getById(t){return this.http.get(`${this.baseUrl}/${t}`)}create(t){return this.http.post(this.baseUrl,t)}update(t,r){return this.http.patch(`${this.baseUrl}/${t}`,r)}delete(t){return this.http.delete(`${this.baseUrl}/${t}`)}static \u0275fac=function(r){return new(r||e)(T(L))};static \u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"})};function Se(e,t){if(e&1&&(o(0,"div",3),n(1),i()),e&2){let r=C();m(),g(r.error)}}function Pe(e,t){e&1&&(o(0,"th",22),n(1,"Nombre"),i())}function Ee(e,t){if(e&1&&(o(0,"td",23),n(1),i()),e&2){let r=t.$implicit;m(),g(r.name)}}function ke(e,t){e&1&&(o(0,"th",22),n(1,"Descripci\xF3n"),i())}function we(e,t){if(e&1&&(o(0,"td",23),n(1),i()),e&2){let r=t.$implicit;m(),g(r.description||"-")}}function Oe(e,t){e&1&&(o(0,"th",22),n(1,"Estado"),i())}function Ie(e,t){if(e&1&&(o(0,"td",23)(1,"mat-chip",24),n(2),i()()),e&2){let r=t.$implicit;m(),_("color",r.status?"primary":"warn"),m(),g(r.status?"Activa":"Inactiva")}}function Te(e,t){e&1&&f(0,"th",22)}function De(e,t){if(e&1){let r=N();o(0,"td",23)(1,"button",25),x("click",function(l){let d=P(r).$implicit,M=C();return E(M.delete(d,l))}),o(2,"mat-icon"),n(3,"delete"),i()()()}}function Ne(e,t){e&1&&f(0,"tr",26)}function Fe(e,t){e&1&&f(0,"tr",27)}function Le(e,t){if(e&1&&(o(0,"tr",28)(1,"td",29),n(2,"No hay categor\xEDas. Crea una arriba."),i()()),e&2){let r=C();m(),ot("colspan",r.displayedColumns.length)}}var B=class e{fb=s(pt);categoryService=s(V);cdr=s(F);form;dataSource=new At([]);loading=!1;saving=!1;error="";displayedColumns=["name","description","status","actions"];constructor(){this.form=this.fb.nonNullable.group({name:["",[b.required,b.minLength(2)]],description:[""],status:[!0]})}ngOnInit(){this.load()}load(){this.loading=!0,this.error="",this.categoryService.getAll().subscribe({next:t=>{this.dataSource.data=t,this.loading=!1,this.cdr.detectChanges()},error:t=>{let r=t.error?.message??"Error al cargar categor\xEDas";this.loading=!1,setTimeout(()=>{this.error=r},0)}})}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.saving=!0,this.error="",this.categoryService.create(this.form.getRawValue()).subscribe({next:()=>{this.form.reset({name:"",description:"",status:!0}),this.load(),this.saving=!1,this.cdr.detectChanges()},error:t=>{let r=t.error?.message??"Error al guardar";this.saving=!1,setTimeout(()=>{this.error=r},0)}})}delete(t,r){r.stopPropagation(),!(!t.id||!confirm(`\xBFEliminar categor\xEDa "${t.name}"?`))&&this.categoryService.delete(t.id).subscribe({next:()=>{this.load(),this.cdr.detectChanges()},error:a=>{let l=a.error?.message??"Error al eliminar";setTimeout(()=>{this.error=l},0)}})}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=D({type:e,selectors:[["app-category-list"]],decls:42,vars:6,consts:[[1,"category-list-page"],[1,"page-header"],[1,"subtitle"],[1,"error-banner"],[1,"form-card"],[1,"inline-form",3,"ngSubmit","formGroup"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Ej. Electr\xF3nica"],["matInput","","formControlName","description"],["formControlName","status"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[1,"table-card"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","description"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],[3,"color"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(r,a){r&1&&(o(0,"div",0)(1,"div",1)(2,"h1"),n(3,"Categor\xEDas"),i(),o(4,"p",2),n(5,"Crea categor\xEDas para asignar a los productos (ej. Electr\xF3nica, Ropa)."),i()(),u(6,Se,2,1,"div",3),o(7,"mat-card",4)(8,"mat-card-header")(9,"mat-card-title"),n(10,"Nueva categor\xEDa"),i()(),o(11,"mat-card-content")(12,"form",5),x("ngSubmit",function(){return a.onSubmit()}),o(13,"mat-form-field",6)(14,"mat-label"),n(15,"Nombre"),i(),f(16,"input",7),i(),o(17,"mat-form-field",6)(18,"mat-label"),n(19,"Descripci\xF3n (opcional)"),i(),f(20,"input",8),i(),o(21,"mat-checkbox",9),n(22,"Activa"),i(),o(23,"button",10),n(24,"Guardar"),i()()()(),o(25,"mat-card",11)(26,"table",12),v(27,13),h(28,Pe,2,0,"th",14)(29,Ee,2,1,"td",15),y(),v(30,16),h(31,ke,2,0,"th",14)(32,we,2,1,"td",15),y(),v(33,17),h(34,Oe,2,0,"th",14)(35,Ie,3,2,"td",15),y(),v(36,18),h(37,Te,1,0,"th",14)(38,De,4,0,"td",15),y(),h(39,Ne,1,0,"tr",19)(40,Fe,1,0,"tr",20)(41,Le,3,1,"tr",21),i()()()),r&2&&(m(6),p(a.error?6:-1),m(6),_("formGroup",a.form),m(11),_("disabled",a.saving),m(3),_("dataSource",a.dataSource),m(13),_("matHeaderRowDef",a.displayedColumns),m(),_("matRowDefColumns",a.displayedColumns))},dependencies:[S,ft,dt,mt,lt,ct,ut,st,j,U,_t,Ct,gt,bt,yt,vt,xt,Mt,z,H,ht,$,R,$t,Et,wt,Dt,Ot,kt,Nt,It,Tt,Ft,Lt,Rt,jt,Ut,Bt,Vt,zt,Ht],styles:[".category-list-page[_ngcontent-%COMP%]{padding:var(--app-spacing-lg)}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.subtitle[_ngcontent-%COMP%]{margin:.5rem 0 0;color:var(--mat-sys-on-surface-variant);font-size:.9375rem}.error-banner[_ngcontent-%COMP%]{padding:1rem;margin-bottom:1rem;background:var(--mat-sys-error-container);color:var(--mat-sys-on-error-container);border-radius:var(--app-radius-sm)}.form-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.inline-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:1rem}.inline-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:180px}.table-card[_ngcontent-%COMP%]{overflow:hidden}.full-width[_ngcontent-%COMP%]{width:100%}"]})};var q=class e{constructor(t){this.http=t}baseUrl=`${A.apiUrl}/products`;getAll(){return this.http.get(this.baseUrl).pipe(K(t=>Array.isArray(t)?t:t?.data??[]))}getById(t){return this.http.get(`${this.baseUrl}/${t}`).pipe(K(r=>this.normalizeProduct(Array.isArray(r)?null:r)))}normalizeProduct(t){if(!t||typeof t!="object")return{name:"",sku:"",categoryId:0,price:0,status:!0};let a=t.data??t;return{id:Number(a.id)||void 0,name:String(a.name??""),sku:String(a.sku??""),categoryId:Number(a.categoryId??a.category?.id??a.category_id??0),category:a.category,price:Number(a.price??0),status:a.status!==!1&&a.status!=="false",createdAt:a.createdAt??a.created_at}}create(t){return this.http.post(this.baseUrl,{name:t.name,sku:t.sku,categoryId:t.categoryId,price:t.price,status:t.status??!0,currentStock:t.currentStock??0,minStock:t.minStock??0})}update(t,r){let a={};r.name!==void 0&&(a.name=r.name),r.sku!==void 0&&(a.sku=r.sku),r.categoryId!==void 0&&(a.categoryId=r.categoryId),r.price!==void 0&&(a.price=r.price),r.status!==void 0&&(a.status=r.status);let l=r.currentStock,d=r.minStock;return l!==void 0&&(a.currentStock=l),d!==void 0&&(a.minStock=d),this.http.patch(`${this.baseUrl}/${t}`,a)}delete(t){return this.http.delete(`${this.baseUrl}/${t}`)}static \u0275fac=function(r){return new(r||e)(T(L))};static \u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"})};var G=class e{constructor(t){this.http=t}baseUrl=`${A.apiUrl}/inventory`;getAll(){return this.http.get(this.baseUrl)}getByProductId(t){return this.http.get(`${this.baseUrl}/product/${t}`)}update(t,r){return this.http.patch(`${this.baseUrl}/product/${t}`,r)}createMovement(t){return this.http.post(`${this.baseUrl}/movements`,t)}getMovements(t){let r=t?`${this.baseUrl}/movements?productId=${t}`:`${this.baseUrl}/movements`;return this.http.get(r)}static \u0275fac=function(r){return new(r||e)(T(L))};static \u0275prov=I({token:e,factory:e.\u0275fac,providedIn:"root"})};function $e(e,t){if(e&1&&(o(0,"div",5)(1,"mat-icon"),n(2,"error_outline"),i(),o(3,"span"),n(4),i()()),e&2){let r=C();m(4),g(r.error)}}function Ae(e,t){e&1&&(o(0,"div",6),f(1,"mat-spinner",8),o(2,"p"),n(3,"Cargando productos..."),i()())}function Ue(e,t){e&1&&(o(0,"th",26),n(1,"Nombre"),i())}function je(e,t){if(e&1&&(o(0,"td",27),n(1),i()),e&2){let r=t.$implicit;m(),g(r.name)}}function He(e,t){e&1&&(o(0,"th",26),n(1,"SKU"),i())}function ze(e,t){if(e&1&&(o(0,"td",27),n(1),i()),e&2){let r=t.$implicit;m(),g(r.sku)}}function Ve(e,t){e&1&&(o(0,"th",26),n(1,"Categor\xEDa"),i())}function Be(e,t){if(e&1&&(o(0,"td",27),n(1),i()),e&2){let r=t.$implicit;m(),g((r.category==null?null:r.category.name)??"-")}}function qe(e,t){e&1&&(o(0,"th",26),n(1,"Stock"),i())}function Ge(e,t){if(e&1&&(o(0,"td",27)(1,"span",28),n(2),i()()),e&2){let r=t.$implicit;m(2),g(r.currentStock)}}function We(e,t){e&1&&(o(0,"th",26),n(1,"Precio"),i())}function Ke(e,t){if(e&1&&(o(0,"td",29),n(1),i()),e&2){let r=t.$implicit,a=C(2);m(),g(a.formatPrice(r.price))}}function Je(e,t){e&1&&(o(0,"th",26),n(1,"Estado"),i())}function Qe(e,t){if(e&1&&(o(0,"td",27)(1,"mat-chip",30),n(2),i()()),e&2){let r=t.$implicit;m(),_("color",r.status?"primary":"warn"),m(),J(" ",r.status?"Activo":"Inactivo"," ")}}function Xe(e,t){e&1&&(o(0,"th",31),n(1,"Acciones"),i())}function Ye(e,t){if(e&1){let r=N();o(0,"td",32)(1,"button",33),x("click",function(){let l=P(r).$implicit,d=C(2);return E(d.editProduct(l))}),o(2,"mat-icon"),n(3,"edit"),i()(),o(4,"button",34),x("click",function(l){let d=P(r).$implicit,M=C(2);return E(M.deleteProduct(d,l))}),o(5,"mat-icon"),n(6,"delete"),i()()()}}function Ze(e,t){e&1&&f(0,"tr",35)}function tr(e,t){e&1&&f(0,"tr",36)}function er(e,t){if(e&1&&(o(0,"tr",37)(1,"td",38)(2,"mat-icon"),n(3,"inbox"),i(),o(4,"p"),n(5,"No hay productos registrados"),i(),o(6,"a",39),n(7,"Registrar primer producto"),i()()()),e&2){let r=C(2);m(),ot("colspan",r.displayedColumns.length)}}function rr(e,t){if(e&1&&(o(0,"mat-card",7)(1,"div",9)(2,"table",10),v(3,11),h(4,Ue,2,0,"th",12)(5,je,2,1,"td",13),y(),v(6,14),h(7,He,2,0,"th",12)(8,ze,2,1,"td",13),y(),v(9,15),h(10,Ve,2,0,"th",12)(11,Be,2,1,"td",13),y(),v(12,16),h(13,qe,2,0,"th",12)(14,Ge,3,1,"td",13),y(),v(15,17),h(16,We,2,0,"th",12)(17,Ke,2,1,"td",18),y(),v(18,19),h(19,Je,2,0,"th",12)(20,Qe,3,2,"td",13),y(),v(21,20),h(22,Xe,2,0,"th",21)(23,Ye,7,0,"td",22),y(),h(24,Ze,1,0,"tr",23)(25,tr,1,0,"tr",24)(26,er,8,1,"tr",25),i()()()),e&2){let r=C();m(2),_("dataSource",r.dataSource),m(22),_("matHeaderRowDef",r.displayedColumns),m(),_("matRowDefColumns",r.displayedColumns)}}var W=class e{productService=s(q);inventoryService=s(G);router=s(nt);cdr=s(F);displayedColumns=["name","sku","category","stock","price","status","actions"];dataSource=new At([]);loading=!1;error="";ngOnInit(){this.loadProducts()}loadProducts(){this.loading=!0,this.error="",Qt({products:this.productService.getAll(),inventory:this.inventoryService.getAll().pipe(et(()=>tt([])))}).pipe(K(({products:t,inventory:r})=>{let a=Array.isArray(t)?t:[],l=new Map;return r.forEach(d=>l.set(d.productId,d.currentStock)),a.map(d=>Kt(Wt({},d),{currentStock:l.get(d.id)??0}))}),Xt(()=>this.loading=!1)).subscribe({next:t=>{this.dataSource.data=Array.isArray(t)?t:[],this.cdr.markForCheck()},error:t=>{this.error=t.error?.message??t.message??"Error al cargar productos"}})}editProduct(t){let r=t?.id!=null?Number(t.id):NaN;Number.isFinite(r)&&this.router.navigate(["/inventory","edit",r])}deleteProduct(t,r){r.stopPropagation(),!(!t.id||!confirm(`\xBFEliminar "${t.name}"?`))&&this.productService.delete(t.id).subscribe({next:()=>this.loadProducts(),error:a=>{this.error=a.error?.message??"Error al eliminar"}})}formatPrice(t){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(Number(t))}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=D({type:e,selectors:[["app-product-list"]],decls:14,vars:2,consts:[[1,"product-list-page"],[1,"list-header"],[1,"list-header-title"],[1,"list-title-icon"],["mat-flat-button","","color","primary","routerLink","/inventory/new",1,"btn-new"],[1,"list-error"],[1,"list-loading"],[1,"table-card"],["diameter","48"],[1,"table-wrapper"],["mat-table","",1,"products-table",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","sku"],["matColumnDef","category"],["matColumnDef","stock"],["matColumnDef","price"],["mat-cell","","class","price-cell",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-cell","","class","actions-header",4,"matHeaderCellDef"],["mat-cell","","class","actions-cell",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","table-row",4,"matRowDef","matRowDefColumns"],["class","mat-row empty-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],[1,"stock-badge"],["mat-cell","",1,"price-cell"],[3,"color"],["mat-header-cell","",1,"actions-header"],["mat-cell","",1,"actions-cell"],["mat-icon-button","","matTooltip","Editar producto",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar",3,"click"],["mat-header-row",""],["mat-row","",1,"table-row"],[1,"mat-row","empty-row"],[1,"mat-cell","empty-cell"],["mat-button","","color","primary","routerLink","/inventory/new"]],template:function(r,a){r&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),n(4,"inventory"),i(),o(5,"h1"),n(6,"Inventario de productos"),i()(),o(7,"a",4)(8,"mat-icon"),n(9,"add"),i(),n(10," Nuevo producto "),i()(),u(11,$e,5,1,"div",5),u(12,Ae,4,0,"div",6)(13,rr,27,3,"mat-card",7),i()),r&2&&(m(11),p(a.error?11:-1),m(),p(a.loading?12:13))},dependencies:[S,at,$t,Et,wt,Dt,Ot,kt,Nt,It,Tt,Ft,Lt,Rt,z,H,ht,j,U,zt,Ht,$,R,Pt,St,Bt,Vt],styles:[".product-list-page[_ngcontent-%COMP%]{padding:var(--app-spacing-lg)}.list-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:var(--app-spacing)}.list-header-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.list-title-icon[_ngcontent-%COMP%]{font-size:2rem;width:2rem;height:2rem;color:var(--mat-sys-primary)}.list-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.5rem;font-weight:600;color:var(--mat-sys-on-surface)}.btn-new[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:.5rem;vertical-align:middle}.list-error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:1rem;margin-bottom:var(--app-spacing);background:var(--mat-sys-error-container);color:var(--mat-sys-on-error-container);border-radius:var(--app-radius-sm);font-size:.9375rem}.list-error[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.5rem;width:1.5rem;height:1.5rem;flex-shrink:0}.list-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;gap:1rem}.list-loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--mat-sys-on-surface-variant);font-size:.9375rem}.table-card[_ngcontent-%COMP%]{border-radius:var(--app-radius-md);box-shadow:var(--app-shadow);overflow:hidden;padding:0}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.products-table[_ngcontent-%COMP%]{width:100%;background:var(--mat-sys-surface)}.products-table[_ngcontent-%COMP%]   .mat-mdc-header-row[_ngcontent-%COMP%]{background:var(--mat-sys-surface-container-highest, #e6e0e9)}.products-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;font-size:.875rem;color:var(--mat-sys-on-surface-variant);padding:1rem 1.25rem}.products-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{padding:1rem 1.25rem;font-size:.9375rem}.products-table[_ngcontent-%COMP%]   .table-row[_ngcontent-%COMP%]:hover{background:var(--mat-sys-surface-container-low, #f5f5f5)}.stock-badge[_ngcontent-%COMP%]{display:inline-block;min-width:2rem;padding:.25rem .5rem;text-align:center;background:var(--mat-sys-surface-container-highest, #e6e0e9);border-radius:var(--app-radius-sm);font-weight:500;font-size:.875rem}.price-cell[_ngcontent-%COMP%]{font-weight:500;color:var(--mat-sys-primary)}.actions-header[_ngcontent-%COMP%]{text-align:center}.actions-cell[_ngcontent-%COMP%]{white-space:nowrap}.actions-cell[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25rem}.empty-row[_ngcontent-%COMP%]   .empty-cell[_ngcontent-%COMP%]{padding:3rem 2rem!important;text-align:center;vertical-align:middle}.empty-cell[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:var(--mat-sys-outline-variant);margin-bottom:1rem;display:block;margin-left:auto;margin-right:auto}.empty-cell[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 1rem;color:var(--mat-sys-on-surface-variant);font-size:.9375rem}.empty-cell[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{margin-top:.5rem}"]})};var ir=(e,t)=>t.id;function or(e,t){e&1&&(o(0,"div",4),f(1,"mat-spinner",6),o(2,"p"),n(3,"Cargando producto..."),i()())}function nr(e,t){if(e&1&&(o(0,"div",8)(1,"mat-icon"),n(2,"error_outline"),i(),o(3,"span"),n(4),i()()),e&2){let r=C(2);m(4),g(r.error)}}function ar(e,t){e&1&&(o(0,"mat-error"),n(1,"El nombre es obligatorio"),i())}function mr(e,t){e&1&&(o(0,"mat-error"),n(1,"M\xEDnimo 2 caracteres"),i())}function lr(e,t){e&1&&(o(0,"mat-error"),n(1,"El SKU es obligatorio"),i())}function cr(e,t){e&1&&(o(0,"mat-error"),n(1,"M\xEDnimo 2 caracteres"),i())}function dr(e,t){if(e&1&&(o(0,"mat-option",15),n(1),i()),e&2){let r=t.$implicit;_("value",r.id),m(),g(r.name)}}function sr(e,t){e&1&&(o(0,"mat-error"),n(1,"La categor\xEDa es obligatoria"),i())}function ur(e,t){e&1&&(o(0,"mat-error"),n(1,"El precio es obligatorio"),i())}function pr(e,t){e&1&&(o(0,"mat-error"),n(1,"Debe ser mayor o igual a 0"),i())}function fr(e,t){e&1&&(o(0,"mat-error"),n(1,"Debe ser mayor o igual a 0"),i())}function gr(e,t){e&1&&(o(0,"mat-error"),n(1,"Debe ser mayor o igual a 0"),i())}function _r(e,t){e&1&&f(0,"mat-spinner",24)}function Cr(e,t){if(e&1&&(v(0),o(1,"mat-icon"),n(2),i(),n(3),y()),e&2){let r=C(2);m(2),g(r.isEdit?"save":"add"),m(),J(" ",r.isEdit?"Guardar cambios":"Registrar producto"," ")}}function hr(e,t){if(e&1){let r=N();o(0,"form",7),x("ngSubmit",function(){P(r);let l=C();return E(l.onSubmit())}),u(1,nr,5,1,"div",8),o(2,"div",9)(3,"mat-form-field",10)(4,"mat-label"),n(5,"Nombre del producto"),i(),f(6,"input",11),o(7,"mat-icon",12),n(8,"label"),i(),u(9,ar,2,0,"mat-error"),u(10,mr,2,0,"mat-error"),i(),o(11,"mat-form-field",10)(12,"mat-label"),n(13,"SKU"),i(),f(14,"input",13),o(15,"mat-icon",12),n(16,"qr_code"),i(),u(17,lr,2,0,"mat-error"),u(18,cr,2,0,"mat-error"),i()(),o(19,"div",9)(20,"mat-form-field",10)(21,"mat-label"),n(22,"Categor\xEDa"),i(),o(23,"mat-select",14),Yt(24,dr,2,2,"mat-option",15,ir),i(),o(26,"mat-icon",12),n(27,"category"),i(),u(28,sr,2,0,"mat-error"),i(),o(29,"mat-form-field",10)(30,"mat-label"),n(31,"Precio (pesos colombianos)"),i(),f(32,"input",16),o(33,"mat-icon",12),n(34,"attach_money"),i(),u(35,ur,2,0,"mat-error"),u(36,pr,2,0,"mat-error"),i()(),o(37,"div",9)(38,"mat-form-field",10)(39,"mat-label"),n(40,"Stock actual"),i(),f(41,"input",17),o(42,"mat-icon",12),n(43,"inventory_2"),i(),u(44,fr,2,0,"mat-error"),i(),o(45,"mat-form-field",10)(46,"mat-label"),n(47,"Stock m\xEDnimo (alerta)"),i(),f(48,"input",18),o(49,"mat-icon",12),n(50,"warning"),i(),u(51,gr,2,0,"mat-error"),i()(),o(52,"div",19)(53,"mat-checkbox",20),n(54,"Producto activo (visible en inventario)"),i()(),o(55,"div",21)(56,"button",22)(57,"mat-icon"),n(58,"arrow_back"),i(),n(59," Cancelar "),i(),o(60,"button",23),u(61,_r,1,0,"mat-spinner",24)(62,Cr,4,2,"ng-container"),i()()()}if(e&2){let r,a,l,d,M,Q,X,Y,Z,c=C();_("formGroup",c.form),m(),p(c.error?1:-1),m(8),p((r=c.form.get("name"))!=null&&r.hasError("required")&&((r=c.form.get("name"))!=null&&r.touched)?9:-1),m(),p((a=c.form.get("name"))!=null&&a.hasError("minlength")&&((a=c.form.get("name"))!=null&&a.touched)?10:-1),m(7),p((l=c.form.get("sku"))!=null&&l.hasError("required")&&((l=c.form.get("sku"))!=null&&l.touched)?17:-1),m(),p((d=c.form.get("sku"))!=null&&d.hasError("minlength")&&((d=c.form.get("sku"))!=null&&d.touched)?18:-1),m(6),Zt(c.categories),m(4),p((M=c.form.get("categoryId"))!=null&&M.hasError("required")&&((M=c.form.get("categoryId"))!=null&&M.touched)?28:-1),m(7),p((Q=c.form.get("price"))!=null&&Q.hasError("required")&&((Q=c.form.get("price"))!=null&&Q.touched)?35:-1),m(),p((X=c.form.get("price"))!=null&&X.hasError("min")&&((X=c.form.get("price"))!=null&&X.touched)?36:-1),m(8),p((Y=c.form.get("currentStock"))!=null&&Y.hasError("min")&&((Y=c.form.get("currentStock"))!=null&&Y.touched)?44:-1),m(7),p((Z=c.form.get("minStock"))!=null&&Z.hasError("min")&&((Z=c.form.get("minStock"))!=null&&Z.touched)?51:-1),m(9),_("disabled",c.saving),m(),p(c.saving?61:62)}}var w=class e{fb=s(pt);productService=s(q);categoryService=s(V);inventoryService=s(G);router=s(nt);route=s(te);snackBar=s(ae);cdr=s(F);destroy$=new Jt;form;categories=[];loading=!1;saving=!1;error="";isEdit=!1;productId=null;loadTimeout=null;ngOnInit(){this.form=this.fb.nonNullable.group({name:["",[b.required,b.minLength(2)]],sku:["",[b.required,b.minLength(2)]],categoryId:[null,b.required],price:[0,[b.required,b.min(0)]],status:[!0],currentStock:[0,[b.required,b.min(0)]],minStock:[0,[b.required,b.min(0)]]}),this.categoryService.getAll().pipe(O(this.destroy$)).subscribe({next:r=>this.categories=r,error:()=>this.error="Error al cargar categor\xEDas"});let t=this.route.snapshot.paramMap.get("id");if(t!=null&&t!==""){let r=Number(t);Number.isFinite(r)&&r>0?(this.isEdit=!0,this.productId=r,this.loadProduct(this.productId)):(this.loading=!1,this.error="ID de producto no v\xE1lido.")}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.loadTimeout!=null&&clearTimeout(this.loadTimeout)}loadProduct(t){let r=()=>{this.loadTimeout!=null&&(clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loading=!1,this.cdr.markForCheck()};this.loading=!0,this.error="",this.loadTimeout=setTimeout(()=>{this.loadTimeout=null,this.loading&&(this.loading=!1,this.error="Tiempo de espera agotado. Comprueba que el backend est\xE9 en ejecuci\xF3n (puerto 3000).",this.cdr.markForCheck())},1e4),this.productService.getById(t).pipe(O(this.destroy$)).subscribe({next:a=>{try{let l=a.categoryId??a.category?.id??null;this.form.patchValue({name:a.name??"",sku:a.sku??"",categoryId:l,price:Number(a.price)||0,status:a.status!==!1,currentStock:0,minStock:0}),r(),this.inventoryService.getByProductId(t).pipe(O(this.destroy$),et(()=>tt({currentStock:0,minStock:0}))).subscribe({next:d=>{this.form.patchValue({currentStock:d?.currentStock??0,minStock:d?.minStock??0}),this.cdr.markForCheck()}})}catch{this.error="Error al mostrar los datos del producto.",r()}},error:a=>{this.error=a.error?.message??a.message??"Error al cargar producto. Comprueba que el backend est\xE9 en ejecuci\xF3n (puerto 3000).",r()}})}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.saving=!0,this.error="";let t=this.form.getRawValue(),r=t.categoryId!=null?Number(t.categoryId):null;if(this.isEdit&&this.productId){let a={name:t.name,sku:t.sku,categoryId:r??void 0,price:Number(t.price),status:t.status,currentStock:Number(t.currentStock),minStock:Number(t.minStock)};this.productService.update(this.productId,a).pipe(O(this.destroy$)).subscribe({next:()=>this.showSuccessAndNavigate(),error:l=>{this.error=l.error?.message??"Error al guardar",this.saving=!1}})}else{let a={name:t.name,sku:t.sku,categoryId:r,price:Number(t.price),status:t.status,currentStock:Number(t.currentStock),minStock:Number(t.minStock)};this.productService.create(a).pipe(O(this.destroy$)).subscribe({next:()=>this.showSuccessAndNavigate(),error:l=>{this.error=l.error?.message??"Error al guardar",this.saving=!1}})}}showSuccessAndNavigate(){let t=this.isEdit?"Producto actualizado correctamente":"Producto registrado correctamente";this.snackBar.open(t,"Cerrar",{duration:4e3}),this.saving=!1,this.router.navigate(["/inventory"])}static \u0275fac=function(r){return new(r||e)};static \u0275cmp=D({type:e,selectors:[["app-product-form"]],decls:14,vars:4,consts:[[1,"product-form-page"],[1,"product-form-card"],[1,"form-header"],[1,"form-header-icon"],[1,"form-loading"],[1,"product-form",3,"formGroup"],["diameter","48"],[1,"product-form",3,"ngSubmit","formGroup"],[1,"form-error"],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Ej. Laptop HP 15"],["matPrefix",""],["matInput","","formControlName","sku","placeholder","Ej. PROD-001"],["formControlName","categoryId","placeholder","Selecciona categor\xEDa"],[3,"value"],["matInput","","type","number","formControlName","price","min","0","step","1"],["matInput","","type","number","formControlName","currentStock","min","0"],["matInput","","type","number","formControlName","minStock","min","0"],[1,"form-status"],["formControlName","status"],[1,"form-actions"],["mat-button","","type","button","routerLink","/inventory"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],["diameter","24"]],template:function(r,a){r&1&&(o(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"div",2)(4,"mat-icon",3),n(5),i(),o(6,"div")(7,"mat-card-title"),n(8),i(),o(9,"mat-card-subtitle"),n(10),i()()()(),o(11,"mat-card-content"),u(12,or,4,0,"div",4)(13,hr,63,13,"form",5),i()()()),r&2&&(m(5),g(a.isEdit?"edit":"add_box"),m(3),g(a.isEdit?"Editar producto":"Registrar nuevo producto"),m(2),J(" ",a.isEdit?"Modifica los datos del producto":"Completa los campos para dar de alta un producto"," "),m(2),p(a.loading?12:13))},dependencies:[S,ft,dt,mt,ee,lt,ct,re,ut,st,at,j,U,_t,Ct,ie,gt,bt,yt,vt,oe,ne,xt,Mt,de,ce,le,z,H,jt,Ut,$,R,Pt,St,me],styles:[".product-form-page[_ngcontent-%COMP%]{padding:var(--app-spacing-lg);max-width:720px;margin:0 auto}.product-form-card[_ngcontent-%COMP%]{border-radius:var(--app-radius-lg);box-shadow:var(--app-shadow);overflow:hidden}.product-form-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 0}.form-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:1rem;width:100%}.form-header-icon[_ngcontent-%COMP%]{font-size:2.5rem;width:2.5rem;height:2.5rem;color:var(--mat-sys-primary);flex-shrink:0}.form-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{margin:0;font-size:1.375rem;font-weight:600}.form-header[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{margin:.25rem 0 0;font-size:.875rem;color:var(--mat-sys-on-surface-variant)}.product-form-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:1.5rem}.form-loading[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;gap:1rem}.form-loading[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--mat-sys-on-surface-variant);font-size:.9375rem}.product-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:0}.form-error[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.75rem 1rem;margin-bottom:1rem;background:var(--mat-sys-error-container);color:var(--mat-sys-on-error-container);border-radius:var(--app-radius-sm);font-size:.875rem}.form-error[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.25rem;width:1.25rem;height:1.25rem;flex-shrink:0}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:.5rem}@media(max-width:600px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.full-width[_ngcontent-%COMP%]{width:100%}.form-status[_ngcontent-%COMP%]{margin:1rem 0 1.5rem}.form-status[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{font-size:.9375rem}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem;padding-top:1rem;border-top:1px solid var(--mat-sys-outline-variant, #e7e0ec)}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:.5rem;vertical-align:middle}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child   mat-icon[_ngcontent-%COMP%]{margin-right:.5rem}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child   mat-spinner[_ngcontent-%COMP%]{margin-right:.5rem;vertical-align:middle}"]})};var vr=[{path:"",component:W},{path:"categories",component:B},{path:"new",component:w},{path:"edit/:id",component:w}],qt=class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=it({type:e});static \u0275inj=rt({imports:[Gt.forChild(vr),Gt]})};var _e=class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=it({type:e});static \u0275inj=rt({imports:[S,qt,B,W,w]})};export{_e as InventoryModule};
