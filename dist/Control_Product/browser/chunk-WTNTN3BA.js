import{a as re,b as ae,c as ne,d as oe,e as se,f as le,g as me,h as de,i as ce,j as ue,k as pe,l as fe,m as he,n as ge,o as _e,p as Ce,q as be,r as Ue,s as ve,t as xe,u as Me,v as we}from"./chunk-PESQD6XR.js";import"./chunk-Y26WRQJA.js";import{a as F,b as H}from"./chunk-W5UQ6ECB.js";import"./chunk-DQFV7RUH.js";import"./chunk-SB62MEXX.js";import{a as Y,g as Z,h as ee,k as te,l as ie}from"./chunk-45557K5V.js";import{$ as b,$a as g,$b as R,$c as A,Ab as T,Ia as y,Ma as d,R as E,Rc as O,Ta as D,Tc as l,Ua as U,V as I,Va as v,Vc as V,W as w,Wc as N,Ya as c,Yc as P,Za as r,_ as C,_a as a,_c as k,bd as q,cc as L,cd as $,db as u,eb as p,ed as G,fd as j,gb as S,gd as B,hd as z,ib as _,jd as J,kb as f,kd as K,md as Q,nd as W,od as X,wa as s,yb as n,zb as m}from"./chunk-3DDZNKYA.js";var x=class t{constructor(e){this.http=e}baseUrl=`${G.apiUrl}/users`;getAll(){return this.http.get(this.baseUrl)}create(e){return this.http.post(this.baseUrl,e)}update(e,i){return this.http.patch(`${this.baseUrl}/${e}`,i)}delete(e){return this.http.delete(`${this.baseUrl}/${e}`)}static \u0275fac=function(i){return new(i||t)(I(L))};static \u0275prov=E({token:t,factory:t.\u0275fac,providedIn:"root"})};function ye(t,e){if(t&1&&(r(0,"div",3),n(1),a()),t&2){let i=f();s(),m(i.error)}}function De(t,e){t&1&&(r(0,"div",13)(1,"mat-checkbox",30),n(2,"Usuario activo"),a()())}function Te(t,e){if(t&1){let i=S();r(0,"button",31),_("click",function(){C(i);let h=f();return b(h.cancelEdit())}),n(1,"Cancelar"),a()}}function Re(t,e){t&1&&(r(0,"th",32),n(1,"Nombre"),a())}function Le(t,e){if(t&1&&(r(0,"td",33),n(1),a()),t&2){let i=e.$implicit;s(),m(i.name)}}function Oe(t,e){t&1&&(r(0,"th",32),n(1,"Correo"),a())}function Ve(t,e){if(t&1&&(r(0,"td",33),n(1),a()),t&2){let i=e.$implicit;s(),m(i.email)}}function Ne(t,e){t&1&&(r(0,"th",32),n(1,"Rol"),a())}function Pe(t,e){if(t&1&&(r(0,"td",33),n(1),a()),t&2){let i=e.$implicit;s(),m(i.role==="ADMIN"?"Administrador":"Usuario")}}function ke(t,e){t&1&&(r(0,"th",32),n(1,"Estado"),a())}function Ae(t,e){if(t&1&&(r(0,"td",33)(1,"mat-chip",34),n(2),a()()),t&2){let i=e.$implicit;s(),c("color",i.status?"primary":"warn"),s(),m(i.status?"Activo":"Inactivo")}}function qe(t,e){t&1&&(r(0,"th",32),n(1,"Registro"),a())}function $e(t,e){if(t&1&&(r(0,"td",33),n(1),a()),t&2){let i=e.$implicit,o=f();s(),m(o.formatDate(i.created_at))}}function Fe(t,e){t&1&&(r(0,"th",32),n(1,"Acciones"),a())}function He(t,e){if(t&1){let i=S();r(0,"td",33)(1,"button",35),_("click",function(){let h=C(i).$implicit,M=f();return b(M.startEdit(h))}),r(2,"mat-icon"),n(3,"edit"),a()(),r(4,"button",36),_("click",function(h){let M=C(i).$implicit,Ee=f();return b(Ee.deleteUser(M,h))}),r(5,"mat-icon"),n(6,"delete"),a()()()}}function Ge(t,e){t&1&&g(0,"tr",37)}function je(t,e){t&1&&g(0,"tr",38)}function Be(t,e){if(t&1&&(r(0,"tr",39)(1,"td",40),n(2,"No hay usuarios."),a()()),t&2){let i=f();s(),D("colspan",i.displayedColumns.length)}}var Se=class t{fb=w(q);userService=w(x);form;dataSource=new he([]);loading=!1;saving=!1;error="";editingUserId=null;displayedColumns=["name","email","role","status","created_at","actions"];constructor(){this.form=this.fb.nonNullable.group({name:["",[l.required]],email:["",[l.required,l.email]],password:["",[l.required,l.minLength(6)]],role:["USER",[l.required]],status:[!0]})}ngOnInit(){this.load()}load(){this.loading=!0,this.error="",this.userService.getAll().subscribe({next:e=>{this.dataSource.data=e,this.loading=!1},error:e=>{this.error=e.error?.message??"Error al cargar usuarios",this.loading=!1}})}startEdit(e){this.editingUserId=e.id,this.form.patchValue({name:e.name,email:e.email,password:"",role:e.role??"USER",status:e.status}),this.form.get("password")?.clearValidators(),this.form.get("password")?.updateValueAndValidity()}cancelEdit(){this.editingUserId=null,this.form.reset({name:"",email:"",password:"",role:"USER",status:!0}),this.form.get("password")?.setValidators([l.required,l.minLength(6)]),this.form.get("password")?.updateValueAndValidity()}onSubmit(){this.editingUserId!=null?this.updateUser():this.createUser()}createUser(){if(this.form.get("password")?.setValidators([l.required,l.minLength(6)]),this.form.get("password")?.updateValueAndValidity(),this.form.invalid){this.form.markAllAsTouched();return}this.saving=!0,this.error="";let e=this.form.getRawValue();this.userService.create(e).subscribe({next:()=>{this.form.reset({name:"",email:"",password:"",role:"USER",status:!0}),this.load(),this.saving=!1},error:i=>{this.error=i.error?.message??"Error al crear usuario",this.saving=!1}})}updateUser(){if(!this.editingUserId)return;let e=this.form.getRawValue();if(!e.name?.trim()||!e.email?.trim()){this.form.markAllAsTouched();return}let i={name:e.name,email:e.email,role:e.role,status:e.status};e.password&&e.password.length>=6&&(i.password=e.password),this.saving=!0,this.error="",this.userService.update(this.editingUserId,i).subscribe({next:()=>{this.editingUserId=null,this.form.reset({name:"",email:"",password:"",role:"USER",status:!0}),this.form.get("password")?.setValidators([l.required,l.minLength(6)]),this.load(),this.saving=!1},error:o=>{this.error=o.error?.message??"Error al actualizar usuario",this.saving=!1}})}deleteUser(e,i){i.stopPropagation(),confirm(`\xBFEliminar al usuario "${e.name}" (${e.email})?`)&&this.userService.delete(e.id).subscribe({next:()=>this.load(),error:o=>{this.error=o.error?.message??"Error al eliminar usuario"}})}formatDate(e){return e?new Date(e).toLocaleDateString("es"):"-"}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=y({type:t,selectors:[["app-user-list"]],decls:61,vars:12,consts:[[1,"user-list-page"],[1,"page-header"],[1,"subtitle"],[1,"error-banner"],[1,"form-card"],[1,"inline-form",3,"ngSubmit","formGroup"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Nombre completo"],["matInput","","type","email","formControlName","email","placeholder","email@ejemplo.com"],["matInput","","type","password","formControlName","password",3,"placeholder"],["formControlName","role"],["value","USER"],["value","ADMIN"],[1,"form-status"],[1,"form-actions"],["mat-button","","type","button"],["mat-flat-button","","color","primary","type","submit",3,"disabled"],[1,"table-card"],["mat-table","",1,"full-width",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","role"],["matColumnDef","status"],["matColumnDef","created_at"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["formControlName","status"],["mat-button","","type","button",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"color"],["mat-icon-button","","matTooltip","Editar usuario",3,"click"],["mat-icon-button","","color","warn","matTooltip","Eliminar usuario",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],[1,"mat-cell"]],template:function(i,o){i&1&&(r(0,"div",0)(1,"div",1)(2,"h1"),n(3,"Usuarios"),a(),r(4,"p",2),n(5),a()(),U(6,ye,2,1,"div",3),r(7,"mat-card",4)(8,"mat-card-header")(9,"mat-card-title"),n(10),a()(),r(11,"mat-card-content")(12,"form",5),_("ngSubmit",function(){return o.onSubmit()}),r(13,"mat-form-field",6)(14,"mat-label"),n(15,"Nombre"),a(),g(16,"input",7),a(),r(17,"mat-form-field",6)(18,"mat-label"),n(19,"Correo"),a(),g(20,"input",8),a(),r(21,"mat-form-field",6)(22,"mat-label"),n(23,"Contrase\xF1a"),a(),g(24,"input",9),a(),r(25,"mat-form-field",6)(26,"mat-label"),n(27,"Rol"),a(),r(28,"mat-select",10)(29,"mat-option",11),n(30,"Usuario"),a(),r(31,"mat-option",12),n(32,"Administrador"),a()()(),U(33,De,3,0,"div",13),r(34,"div",14),U(35,Te,2,0,"button",15),r(36,"button",16),n(37),a()()()()(),r(38,"mat-card",17)(39,"table",18),u(40,19),d(41,Re,2,0,"th",20)(42,Le,2,1,"td",21),p(),u(43,22),d(44,Oe,2,0,"th",20)(45,Ve,2,1,"td",21),p(),u(46,23),d(47,Ne,2,0,"th",20)(48,Pe,2,1,"td",21),p(),u(49,24),d(50,ke,2,0,"th",20)(51,Ae,3,2,"td",21),p(),u(52,25),d(53,qe,2,0,"th",20)(54,$e,2,1,"td",21),p(),u(55,26),d(56,Fe,2,0,"th",20)(57,He,7,0,"td",21),p(),d(58,Ge,1,0,"tr",27)(59,je,1,0,"tr",28)(60,Be,3,1,"tr",29),a()()()),i&2&&(s(5),m(o.editingUserId!=null?"Edita los datos del usuario.":"Registra nuevos usuarios o edita los existentes."),s(),v(o.error?6:-1),s(4),m(o.editingUserId!=null?"Editar usuario":"Nuevo usuario"),s(2),c("formGroup",o.form),s(12),c("placeholder",o.editingUserId!=null?"Dejar en blanco para no cambiar":"M\xEDnimo 6 caracteres"),s(9),v(o.editingUserId!=null?33:-1),s(2),v(o.editingUserId!=null?35:-1),s(),c("disabled",o.saving),s(),T(" ",o.editingUserId!=null?"Guardar cambios":"Crear usuario"," "),s(2),c("dataSource",o.dataSource),s(19),c("matHeaderRowDef",o.displayedColumns),s(),c("matRowDefColumns",o.displayedColumns))},dependencies:[R,$,P,O,V,N,A,k,K,j,z,J,B,ee,Z,Y,ie,te,X,W,Q,fe,re,ne,me,oe,ae,de,se,le,ce,ue,pe,be,Ce,we,Me,xe,H,F,ve,Ue,_e,ge],styles:[".user-list-page[_ngcontent-%COMP%]{padding:1rem}.page-header[_ngcontent-%COMP%]{margin-bottom:1.5rem}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .25rem}.subtitle[_ngcontent-%COMP%]{margin:0;color:var(--mat-form-field-supporting-text-color, #666)}.error-banner[_ngcontent-%COMP%]{background:#f44336;color:#fff;padding:.75rem 1rem;border-radius:4px;margin-bottom:1rem}.form-card[_ngcontent-%COMP%]{margin-bottom:1.5rem}.inline-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;align-items:flex-start}.inline-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%], .inline-form[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{flex:0 0 auto}.form-status[_ngcontent-%COMP%]{display:flex;align-items:center}.form-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.table-card[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}"]})};export{Se as UserList};
